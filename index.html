<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ª®ng D·ª•ng B·∫ßu Ch·ªçn</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f4f4f9; }
        h1 { text-align: center; color: #333; }
        
        /* Loading Spinner */
        #loading { text-align: center; font-style: italic; color: #666; margin-top: 20px; }
        
        /* Danh s√°ch ·ª©ng vi√™n */
        .candidate-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .candidate-name { font-weight: bold; font-size: 1.1em; }
        
        /* N√∫t Vote */
        .btn-vote {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn-vote:hover { background-color: #0056b3; }
        .btn-vote:disabled { background-color: #ccc; cursor: not-allowed; }

        /* Th√¥ng b√°o l·ªói/th√†nh c√¥ng */
        #message { text-align: center; margin-top: 10px; height: 20px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>

    <h1>üó≥Ô∏è B·∫ßu Ch·ªçn Nh√≥m</h1>

    <div id="message"></div>

    <div id="loading">‚è≥ ƒêang t·∫£i danh s√°ch...</div>

    <div id="list-container"></div>

    <script>
        // --- C·∫§U H√åNH ---
        // QUAN TR·ªåNG: D√°n link Web App URL c·ªßa b·∫°n v√†o ƒë√¢y
        // Link ph·∫£i c√≥ ƒëu√¥i /exec (kh√¥ng ph·∫£i /dev)
        const API_URL = "https://script.google.com/macros/s/AKfycbwvjp7E3rwyv7E-0C5CB-K6-m7BKPXikMXroNY-OkpTpD-_PRQ691IOVaKf1F_jn-K_Rw/exec"; 

        // 1. H√†m l·∫•y danh s√°ch khi m·ªü web
        async function loadCandidates() {
            const loadingEl = document.getElementById('loading');
            const container = document.getElementById('list-container');
            
            try {
                // G·ªçi API v·ªõi action=getList
                const response = await fetch(API_URL + "?action=getList");
                const json = await response.json();

                if (json.status === "success") {
                    renderList(json.data);
                } else {
                    document.getElementById('message').innerText = "L·ªói: " + json.message;
                    document.getElementById('message').className = "error";
                }
            } catch (error) {
                console.error(error);
                document.getElementById('message').innerText = "Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn Server!";
                document.getElementById('message').className = "error";
            } finally {
                // T·∫Øt loading d√π th√†nh c√¥ng hay th·∫•t b·∫°i
                loadingEl.style.display = 'none';
            }
        }

        // 2. H√†m v·∫Ω danh s√°ch ra m√†n h√¨nh
        function renderList(candidates) {
            const container = document.getElementById('list-container');
            container.innerHTML = ""; // X√≥a c≈©

            if (candidates.length === 0) {
                container.innerHTML = "<p style='text-align:center'>Danh s√°ch tr·ªëng</p>";
                return;
            }

            candidates.forEach(c => {
                const div = document.createElement('div');
                div.className = 'candidate-card';
                div.innerHTML = `
                    <span class="candidate-name">${c.name}</span> <button class="btn-vote" onclick="handleVote('${c.name}')">B·∫ßu ch·ªçn</button>
                `;
                container.appendChild(div);
            });
        }

        // 3. H√†m x·ª≠ l√Ω khi b·∫•m n√∫t Vote
        function handleVote(tenUngVien) {
            // H·ªèi t√™n ng∆∞·ªùi b·∫ßu (ho·∫∑c b·∫°n c√≥ th·ªÉ fix c·ª©ng n·∫øu mu·ªën)
            const nguoiBau = prompt("B·∫°n t√™n l√† g√¨?");
            if (!nguoiBau) return; // N·∫øu b·∫•m h·ªßy th√¨ th√¥i

            // Hi·ªáu ·ª©ng ƒëang g·ª≠i...
            const msgEl = document.getElementById('message');
            msgEl.innerText = "ƒêang g·ª≠i phi·∫øu...";
            msgEl.className = "";

            // G·ª≠i d·ªØ li·ªáu ƒëi (D√πng text/plain ƒë·ªÉ tr√°nh l·ªói CORS c·ªßa Google)
            fetch(API_URL + "?action=vote", {
                method: "POST",
                body: JSON.stringify({
                    nguoiBau: nguoiBau,
                    bauChoAi: tenUngVien
                })
            })
            .then(res => res.json())
            .then(data => {
                if(data.status === "success") {
                    msgEl.innerText = "‚úÖ ƒê√£ b·∫ßu th√†nh c√¥ng cho " + tenUngVien;
                    msgEl.className = "success";
                } else {
                    msgEl.innerText = "‚ùå L·ªói: " + data.message;
                    msgEl.className = "error";
                }
            })
            .catch(err => {
                msgEl.innerText = "‚ùå L·ªói k·∫øt n·ªëi!";
                msgEl.className = "error";
            });
        }

        // Ch·∫°y h√†m l·∫•y danh s√°ch ngay khi t·∫£i trang
        loadCandidates();
    </script>
</body>
</html>
